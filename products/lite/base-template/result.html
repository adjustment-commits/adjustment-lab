<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LITE BASE｜グラフ表示</title>
<meta name="theme-color" content="#f8faf9">
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: 'Noto Sans JP', sans-serif;
  background: #f8faf9;
  color: #1a1a1a;
  margin: 0;
  padding: 20px;
  max-width: 700px;
  margin: auto;
}
h1 {
  text-align: center;
  color: #00b386;
  margin-bottom: 20px;
}
canvas {
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  padding: 10px;
}
button {
  display: block;
  width: 100%;
  background: #00b386;
  color: #fff;
  border: none;
  padding: 12px;
  font-size: 1.1rem;
  border-radius: 6px;
  margin-top: 30px;
  cursor: pointer;
  transition: 0.3s;
}
button:hover {
  background: #009270;
}
#noData {
  text-align: center;
  margin-top: 40px;
  color: #666;
}
</style>
</head>

<body>
<h1>トレーニング記録グラフ</h1>
<canvas id="trainingChart"></canvas>
<div id="noData" style="display:none;">📉 データがまだありません。</div>

<button onclick="window.location.href='index.html'">← 記録入力に戻る</button>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const ctx = document.getElementById("trainingChart");
  const data = JSON.parse(localStorage.getItem("trainingRecords")) || [];

  if (data.length === 0) {
    document.getElementById("noData").style.display = "block";
    ctx.style.display = "none";
    return;
  }

  // 日付順にソート
  data.sort((a,b) => new Date(a.date) - new Date(b.date));

  const labels = data.map(d => d.date);
  const rpe = data.map(d => Number(d.rpe));
  const hr = data.map(d => Number(d.hr) || null);
  const distance = data.map(d => Number(d.distance) || null);

  new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [
        {
          label: "RPE（主観的強度）",
          data: rpe,
          borderColor: "#00b386",
          backgroundColor: "rgba(0,179,134,0.2)",
          tension: 0.3,
          fill: false
        },
        {
          label: "距離（km）",
          data: distance,
          borderColor: "#009e60",
          backgroundColor: "rgba(0,158,96,0.2)",
          tension: 0.3,
          fill: false
        },
        {
          label: "心拍数（bpm）",
          data: hr,
          borderColor: "#ff7043",
          backgroundColor: "rgba(255,112,67,0.2)",
          tension: 0.3,
          fill: false
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true },
        x: { ticks: { autoSkip: true, maxTicksLimit: 7 } }
      },
      plugins: {
        legend: { position: "bottom" },
        tooltip: {
          callbacks: {
            label: function(context) {
              return context.dataset.label + "：" + context.parsed.y;
            }
          }
        }
      }
    }
  });
});
</script>

<!-- ===== 共通フッター ===== -->
<div id="footer"></div>
<script>
fetch("/adjustment-lab/assets/footer-lite.html")
  .then(res => res.text())
  .then(html => { document.getElementById("footer").innerHTML = html; });
</script>
</body>
</html>
