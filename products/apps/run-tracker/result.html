<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RUN TRACKERï½œçµæœ</title>
<meta name="theme-color" content="#f8faf9">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: 'Noto Sans JP', sans-serif;
  background: #f8faf9;
  color: #1a1a1a;
  margin: 0;
  padding: 20px;
  max-width: 800px;
  margin: auto;
  line-height: 1.7;
}
h1 {
  text-align: center;
  color: #00b386;
  margin-bottom: 20px;
}
canvas {
  margin-top: 30px;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
#comment {
  margin-top: 40px;
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  line-height: 1.8;
}
button {
  margin-top: 30px;
  width: 100%;
  background: #555;
  color: #fff;
  border: none;
  padding: 12px;
  font-size: 1.1rem;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.3s;
}
button:hover {
  background: #333;
}

/* Footer */
footer {
  text-align: center;
  color: #666;
  font-size: 0.85rem;
  margin: 80px 0 40px;
  line-height: 1.6;
}
footer a {
  color: #00b386;
  text-decoration: none;
  transition: 0.3s ease;
}
footer a:hover {
  text-decoration: underline;
}
footer small {
  display: block;
  margin-top: 6px;
  color: #999;
}
</style>
</head>

<body>
<h1>RUN TRACKERï½œçµæœ</h1>

<canvas id="chart" height="220"></canvas>

<div id="comment"></div>

<button onclick="window.location.href='index.html'">â† è¨˜éŒ²å…¥åŠ›ã«æˆ»ã‚‹</button>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const data = JSON.parse(localStorage.getItem("trainingRecords")) || [];

  if (data.length === 0) {
    document.getElementById("comment").innerHTML = "<p>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
    return;
  }

  const dates = data.map(d => d.date);
  const rpe = data.map(d => Number(d.rpe));
  const hr = data.map(d => Number(d.hr));
  const dist = data.map(d => Number(d.distance));

  // === Chart.js ===
  const ctx = document.getElementById("chart").getContext("2d");
  new Chart(ctx, {
    type: "line",
    data: {
      labels: dates,
      datasets: [
        {
          label: "RPE",
          data: rpe,
          borderColor: "#00b386",
          backgroundColor: "rgba(0,179,134,0.1)",
          yAxisID: "y1",
          tension: 0.3
        },
        {
          label: "å¿ƒæ‹æ•° (bpm)",
          data: hr,
          borderColor: "#ff8a65",
          backgroundColor: "rgba(255,138,101,0.1)",
          yAxisID: "y2",
          tension: 0.3
        },
        {
          label: "è·é›¢ (km)",
          data: dist,
          borderColor: "#3f51b5",
          backgroundColor: "rgba(63,81,181,0.1)",
          yAxisID: "y3",
          tension: 0.3
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y1: { type: "linear", position: "left", beginAtZero: true, title: { display: true, text: "RPE" } },
        y2: { type: "linear", position: "right", beginAtZero: true, grid: { drawOnChartArea: false }, title: { display: true, text: "å¿ƒæ‹æ•°" } },
        y3: { display: false }
      },
      plugins: {
        legend: { position: "bottom" }
      }
    }
  });

  // === ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆ ===
  const avgRPE = rpe.reduce((a,b)=>a+b,0) / rpe.length;
  const avgHR = hr.filter(n=>!isNaN(n)).reduce((a,b)=>a+b,0) / hr.filter(n=>!isNaN(n)).length;
  const avgDist = dist.filter(n=>!isNaN(n)).reduce((a,b)=>a+b,0) / dist.filter(n=>!isNaN(n)).length;

  let msg = "";

  if (avgRPE > 7) {
    msg += "ğŸ”¥ é«˜ã„å¼·åº¦ãŒç¶šã„ã¦ã„ã¾ã™ã€‚ä½“ã¯ç¢ºå®Ÿã«é©å¿œã—ã¦ã„ã¾ã™ãŒã€ä¼‘é¤Šã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚<br>";
  } else if (avgRPE < 4) {
    msg += "âš¡ è² è·ãŒè»½ã‚ã§ã™ã€‚æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€å°‘ã—å¼·åº¦ã‚’ä¸Šã’ã¦åˆºæ¿€ã‚’å…¥ã‚Œã¦ã„ãã¾ã—ã‚‡ã†ã€‚<br>";
  } else {
    msg += "ğŸ’ª é©åˆ‡ãªå¼·åº¦ã§ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãŒç©ã‚ã¦ã„ã¾ã™ã€‚ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„çŠ¶æ…‹ã§ã™ã€‚<br>";
  }

  if (avgHR > 160) {
    msg += "â¤ï¸â€ğŸ”¥ å¿ƒæ‹æ•°ãŒé«˜ã‚ã§ã™ã€‚ç–²åŠ´ã‚„ã‚¹ãƒˆãƒ¬ã‚¹ãŒè“„ç©ã—ã¦ã„ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚<br>";
  } else if (avgHR < 100) {
    msg += "ğŸ«€ ä½å¿ƒæ‹ã§å®‰å®šã—ã¦ã„ã¾ã™ã€‚ãƒªã‚«ãƒãƒªãƒ¼æœŸã¨ã—ã¦ç†æƒ³çš„ã§ã™ã€‚<br>";
  }

  if (avgDist > 5) {
    msg += "ğŸƒâ€â™‚ï¸ è·é›¢ãŒå®‰å®šã—ã¦ä¼¸ã³ã¦ã„ã¾ã™ã€‚æŒä¹…åŠ›å¼·åŒ–ãŒé€²è¡Œä¸­ã§ã™ã€‚<br>";
  } else if (avgDist < 2) {
    msg += "ğŸ“‰ è·é›¢ãŒçŸ­ã‚ã§ã™ã€‚ç„¡ç†ã®ãªã„ç¯„å›²ã§å°‘ã—ãšã¤è·é›¢ã‚’ä¼¸ã°ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚<br>";
  }

  msg += "<br><b>æœ€çµ‚çš„ã«å¤§åˆ‡ãªã®ã¯ã€â€œç¶šã‘ã‚‹ã“ã¨â€ã€‚</b><br>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é‡ã‚ˆã‚Šã€ç¿’æ…£åŒ–ã®ç©ã¿é‡ã­ãŒToughã•ã‚’ä½œã‚Šã¾ã™ã€‚";

  document.getElementById("comment").innerHTML = msg;
});
</script>

<footer>
  <p>
    Â© 2025 adjustment-lab<br>
    <a href="/adjustment-lab/legal.html">è²©å£²ãƒ»åˆ©ç”¨è¦ç´„</a>ï½œ
    <a href="/adjustment-lab/contact/index.html">ãŠå•ã„åˆã‚ã›</a><br>
    <small>Produced by æ•´ã€ã‚¢ã‚¸ãƒ£ã‚¹ãƒˆãƒ¡ãƒ³ãƒˆã€‘</small>
  </p>
</footer>

</body>
</html>
