<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Recovery Tracker｜adjustment-lab</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#00b386">

<!-- ✅ PWA統合：manifest / service-worker動的生成 -->
<script>
const manifestData = {
  name: "Recovery Tracker",
  short_name: "Recovery",
  start_url: "./index.html",
  display: "standalone",
  background_color: "#00b386",
  theme_color: "#00b386",
  icons: [
    { src: "icon-192.png", sizes: "192x192", type: "image/png" },
    { src: "icon-512.png", sizes: "512x512", type: "image/png" }
  ]
};
const blob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
const manifestURL = URL.createObjectURL(blob);
const link = document.createElement('link');
link.rel = 'manifest';
link.href = manifestURL;
document.head.appendChild(link);

const swCode = `
const CACHE_NAME = "recovery-tracker-v1";
const FILES_TO_CACHE = ["./", "./index.html"];
self.addEventListener("install", e => {
  e.waitUntil(caches.open(CACHE_NAME).then(c => c.addAll(FILES_TO_CACHE)));
});
self.addEventListener("fetch", e => {
  e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
});
self.addEventListener("activate", e => {
  e.waitUntil(caches.keys().then(keys =>
    Promise.all(keys.map(k => k !== CACHE_NAME && caches.delete(k)))
  ));
});`;
const swBlob = new Blob([swCode], {type: "text/javascript"});
const swURL = URL.createObjectURL(swBlob);
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => navigator.serviceWorker.register(swURL));
}
</script>

<style>
:root {
  --accent: #00b386;
  --bg: #f6faf8;
  --text: #222;
  --sub: #666;
}
body {
  font-family: 'Noto Sans JP', system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 20px;
  max-width: 640px;
  margin: auto;
  line-height: 1.8;
}
h1 {
  text-align: center;
  color: var(--accent);
  margin-top: 30px;
  margin-bottom: 10px;
}
.summary {
  background: #fff;
  padding: 14px 18px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  text-align: center;
  margin-bottom: 20px;
}
.summary strong {
  color: var(--accent);
  font-size: 1.6rem;
}
.input-box {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  padding: 20px;
}
label {
  display: block;
  margin-top: 10px;
  font-size: 14px;
  color: var(--text);
}
input, textarea {
  width: 100%;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
  margin-top: 4px;
}
textarea { resize: vertical; height: 60px; }
button {
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 10px 16px;
  width: 100%;
  margin-top: 16px;
  font-size: 15px;
  cursor: pointer;
}
button:hover { opacity: 0.9; }
.record {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  padding: 16px;
  margin-top: 14px;
}
.record p { margin: 4px 0; }
.record small { color: var(--sub); }
.del {
  background: none;
  border: 1px solid var(--accent);
  color: var(--accent);
  padding: 4px 10px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
}
.del:hover { background: var(--accent); color: #fff; }
footer {
  text-align: center;
  color: #999;
  margin: 40px 0 20px;
  font-size: 13px;
}
</style>
</head>
<body>

<h1>Recovery Tracker</h1>
<div class="summary">
  平均疲労スコア：<strong id="avgFatigue">0.0</strong>／10
</div>

<div class="input-box">
  <label>日付: <input type="date" id="date"></label>
  <label>睡眠時間 (h): <input type="number" step="0.1" id="sleep" placeholder="例: 7.5"></label>
  <label>疲労感 (1〜10): <input type="number" min="1" max="10" id="fatigue" placeholder="例: 5"></label>
  <label>RPE (1〜10): <input type="number" min="1" max="10" id="rpe" placeholder="例: 6"></label>
  <label>コメント: <textarea id="note" placeholder="例: 眠り浅め、朝重い感じ"></textarea></label>
  <button onclick="saveData()">記録する</button>
</div>

<div id="records"></div>
<footer>© 2025 adjustment-lab｜Recovery Tracker</footer>

<script>
function loadData(){
  const data = JSON.parse(localStorage.getItem("recoveryRecords") || "[]");
  const container = document.getElementById("records");
  container.innerHTML = "";
  let total = 0;
  data.forEach((r,i)=>{
    total += parseInt(r.fatigue)||0;
    const div = document.createElement("div");
    div.className="record";
    div.innerHTML = `
      <p><strong>${r.date}</strong>｜疲労:${r.fatigue}/10｜睡眠:${r.sleep}h｜RPE:${r.rpe}</p>
      <p><small>${r.note||""}</small></p>
      <button class="del" onclick="delData(${i})">削除</button>
    `;
    container.appendChild(div);
  });
  const avg = data.length ? (total / data.length).toFixed(1) : 0.0;
  document.getElementById("avgFatigue").textContent = avg;
}

function saveData(){
  const date = document.getElementById("date").value || new Date().toISOString().slice(0,10);
  const sleep = parseFloat(document.getElementById("sleep").value)||0;
  const fatigue = parseInt(document.getElementById("fatigue").value)||0;
  const rpe = parseInt(document.getElementById("rpe").value)||0;
  const note = document.getElementById("note").value;
  if(!fatigue){ alert("疲労感を入力してください"); return; }
  const data = JSON.parse(localStorage.getItem("recoveryRecords") || "[]");
  data.push({date, sleep, fatigue, rpe, note});
  localStorage.setItem("recoveryRecords", JSON.stringify(data));
  document.getElementById("sleep").value="";
  document.getElementById("fatigue").value="";
  document.getElementById("rpe").value="";
  document.getElementById("note").value="";
  loadData();
}

function delData(i){
  const data = JSON.parse(localStorage.getItem("recoveryRecords") || "[]");
  data.splice(i,1);
  localStorage.setItem("recoveryRecords", JSON.stringify(data));
  loadData();
}
loadData();
</script>
</body>
</html>
